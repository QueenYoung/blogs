{"version":3,"sources":["webpack:///path---object-assign-d9de60e97f2eac47831c.js","webpack:///./.cache/json/object-assign.json"],"names":["webpackJsonp","492","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,iBAAAC,OAAA,aAA8CC,gBAAmBC,GAAA,+FAAAC,KAAA,2pnBAA0voBC,aAAqDL,MAAA,sBAAAM,KAAA,gBAAoDC,aAAgBC,KAAA","file":"path---object-assign-d9de60e97f2eac47831c.js","sourcesContent":["webpackJsonp([150799105546278],{\n\n/***/ 492:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Yangkui's Blog\",\"author\":\"Yang Kui\"}},\"markdownRemark\":{\"id\":\"/Users/yk/Documents/blog/src/pages/object-assign/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>在 <em>immutable struct</em> 或者说 <em>functional programming</em> 的影响下, <code>Object.assign</code> 和 <a href=\\\"https://github.com/tc39/proposal-object-rest-spread\\\">Object Spread</a> 是我们离不开的操作. 不过它的功能真的是 <em>shadow copy</em> 吗? 这里我列出一个例子来记录这个问题, 以防以后碰到坑.</p>\\n<p>下面是一个对象, 包括了几种典型的属性:</p>\\n<ol>\\n<li>普通属性</li>\\n<li>get 属性</li>\\n<li>set 属性</li>\\n<li>\\n<p>Symbol</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> obj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\na<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token keyword\\\">get</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__GETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token keyword\\\">set</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span>val<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__SETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> val <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">[</span><span class=\\\"token function\\\">Symbol</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'cool'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'good'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n</li>\\n</ol>\\n<p>先提出问题, 哪种类型的属性会被成功 copy? <code>get 和 set</code> 时候会被运行呢?</p>\\n<p>首先可以确定的是, 连续两次打印 <code>obj.hh</code> 的话, 一定会得到 <code>2, 3</code>. 因为每次 <code>hh</code> 都会被运行对吧.</p>\\n<p>OK, 现在开始对它 <code>assign</code>, 有下面代码</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> shadow <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token operator\\\">...</span>obj<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>这个时候得到的值是多少呢(假设这串代码紧接上面的代码)\\n最后的结果是 <code>4, 4</code>\\n这说明什么? 说明 GET 只被运行了一次后, 就再也没有运行了.\\n那我们打印一下 shadow 的内部看看,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-89bbd.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 27.54491017964072%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAl0lEQVQY052RwQqGIBCEfROz6KSUEaloUQS+/yPNzyzUocMPdRhWZvWbXVTTNME5B2MMmqYRaa3v81spgi7Ys/4LuLznXcXpYozIOWMcR4QQcByHeNQ8z1jXFbVW7PsufXrs0T/PE9u2yXv6qpSClBKWZZHa972kf11bJmQqNQwDvPfouu4zVPFTuArFCQkm1FqLtm1fQ3/LTa6jhPDc2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"06FE5C2C 8A1B 45EE B45D D3DB0774F9FA\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-1a291.png 148w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-2bc4a.png 295w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fb8a0.png 590w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-526de.png 885w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fa2eb.png 1180w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-89bbd.png 1336w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>注意到, 这个时候 hh 只是一个普通的属性, 而不再属于 get set. 作为对比, 我们看下 obj 会输出什么.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-ca8a9.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 26.794871794871796%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAgUlEQVQY052POw7EIAxEOQoQRRASQAgIn2Jz/1PNChco260oxrYs+3nMvPfQWuM8T+z7Tvm6LuoNWWtJSqk555yj2hiDbdvAOZ9iUkrknBFC+Mlj6T34r9gI932j946UEmKMdH0FRsDjONBaI1ApBcPxKmw6rLXi+Tzz3QEVQiwBvz0wj4W+EaSVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"336C40D7 A962 48C0 B485 B81EDD28B4EA\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-1a291.png 148w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-2bc4a.png 295w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fb8a0.png 590w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-526de.png 885w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fa2eb.png 1180w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-ca8a9.png 1560w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>所以结论就是, 普通属性和 Symbol 会被 Copy. 至于 Symbol 时候还是原来那个, 自己测试一下可以发现肯定是的.</p>\\n<p>那么, 另外一个问题. 这些 GET 和 SET 是在什么情况下被执行的呢? 我们可以看到, 上面只打印出了 <strong><em>GETTER</em></strong> 而没有 <strong><em>SETTER</em></strong>, 先引用 MDN 的文档</p>\\n<blockquote>\\n<p>The Object.assign() method only copies enumerable and own properties from a source object to a target object. It uses [[Get]] on the source and [[Set]] on the target, so it will invoke getters and setters.\\n也就是说, 第二个参数的 GET 会被调用, 第一个参数的 SET 会被调用. 而因为 <code>{…obj}</code> 就相当于 <code>Object.assign({},obj)</code>, 所以只有 obj 会被调用.</p>\\n</blockquote>\\n<p>那怎么证明 SET 会被调用呢? 这个简单, 使用 <code>Object.assign(obj, obj)</code> 就行.\\n如果现在的代码是这样的</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> symbol <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Symbol</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'cool'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> obj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  a<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">get</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__GETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">set</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span>val<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__SETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> val <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">[</span>symbol<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'good'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> aha <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">assign</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">,</span> obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>Reflect<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">ownKeys</span><span class=\\\"token punctuation\\\">(</span>aha<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>会出现下面的结果.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 538px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 115.98513011152416%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAACeUlEQVQ4y53VZ04rQRAE4D0FEphksk0y0WQcwIBAFve/TD99LTXCgocQP0aTtquranpmm62trdjb24vT09O4urqKi4uLODg4iNXV1T+15vDwMG5vbxPw7OwsQS8vL8P6nwA7nU6MRqN4fHyM19fXmE6ncX9/H9vb2/nByspKtl8Dkojd5uZmLC4uZmu32zn/DPRb0EZgt9uNXq8X6+vryazb6QZvgVCwv7+f4+Xl5VhaWvoRvClJgs7Pz1P+cDiMt7e3nPf7/WySSiYBBf8DbWog+8nJSYKMx+O4vr5OUAlUgQNzWE9PTzkH+p0VzeeJ7Erm6Ogojo+PY2dnJ4Gc+O7ubrRarbTGnu/Mi8wMIF80H2KGhVLClHwsrbMFoINUCRIjwe8ZQNl5hAm/BJAFiA1A9dgKBqwy7u7uElA8luQnoE1AVTo2MC72CwsLsba2lmPe6X03Pz+f69Y2Njayb8pYnmChkWJTEmNrpFJgjBUF9rEr3zH/AFQSfCKTFCwmk0kMBoPsXUnSjQVTpQpKevk8UzYOReDNzU1mBcB8B6RksDTXF2Pe+9Yc6w9AEm1WgTsYZUOWD63zDAiG+rm5uYzlMU+R+igbCwIxRJ+Ul5eXnD8/P2cvETZ6TCmQSJspGwsYqTuvjTrEQv/w8JAeCbbmVFVDXQKnaz4DaBNgXb1iQpbaq7qjQHA9EiXzy02psqmXu25MBXsrHZSEfP3xtSlAUjDjFanj0TgfXHKdoFN22sDrZvz42gDFTCAQwVjylWz+YVy/i/rvFNvqv7w2spefykhwvT5Y2Te2DqQehupnAAXW6yLg/f09vSNdj3EBUuHWmDtptsD4B/1ettyM7j3pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"7F67AD27 E0D9 42B7 AB4C D67D9A4C7241\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png\\\"\\n        srcset=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-8da5a.png 148w,\\n/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-ca340.png 295w,\\n/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png 538w\\\"\\n        sizes=\\\"(max-width: 538px) 100vw, 538px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>在这里, GET 和 SET 都被调用了一次, 分别是 source 和 target 调用的. 而这个时候 a 变成 12 也不难解释.\\n因为 <code>obj.a</code> 目前是 3. 当 assign 被调用的时候, 内部会有一个 <code>obj.a = obj.a</code> 的过程.  先 GET, 就让 <code>obj.a</code> 变成了 4, 然后是 GET, 也就是 <code>obj.a += obj.a * 4</code> 就成了 12.</p>\\n<p>不过, 值得注意的是, 这里 hh 还是 GET 和 SET, 并没有被替换成普通的属性. 不知道这是不是有意为之.\\n那么如果对象中存在 get 和 set 的时候该怎么复制的呢? 如果用到 ES7 的特性的话, 会很简单</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> realShadow <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPrototypeOf</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-07a60.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 26.848249027237355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAiklEQVQY052PzQrEIAyEfRRbi4rWtv4rFHz/p5rdeCh7XHqYhEnCx4Sd5wmtNfZ9x7ZtsNbCOQel1Jwfx/F4Eu1pRp32Ukpwzh+xdV2RUoL3HrVWXNeFnMv0v4f/ilEh4H3fKKUghABjzCvYBFLs3vuEttZAid/CnoSUbIyBGOP33QwhBJZleQX8AGNYj6u+BZNSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"1A25BA7A 053A 42D7 91AB 2184F28CFAA5\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-1a291.png 148w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-2bc4a.png 295w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fb8a0.png 590w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-526de.png 885w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fa2eb.png 1180w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-07a60.png 1542w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>这里 a 的值还是 3, 说明这个 get 根本没有被执行, 完成没有副作用. 这才是真正的浅拷贝嘛!</p>\\n<p>OK, 那么这里可以得出一个结论: 对于普通的纯对象, 比如 redux 里保存的那些, 使用 <code>assign</code> 没有任何问题. 但如果是自己定义的复杂对象, 带了很多 get 的话, 最好的方式还是采用下面这种最安全的方式吧.</p>\\n<p>值得一提的是, 这也是 MDN 推荐的方式:</p>\\n<blockquote>\\n<p>Whereas the Object.assign() method will only copy enumerable and own properties from a source object to a target object, you are able to use this method and Object.create() for a shallow copy between two unknown objects</p>\\n</blockquote>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>\\n  Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPrototypeOf</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\",\"frontmatter\":{\"title\":\"Object.assign 的一些问题\",\"date\":\"2018/01/31\"}}},\"pathContext\":{\"slug\":\"/object-assign/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---object-assign-d9de60e97f2eac47831c.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Yangkui's Blog\",\"author\":\"Yang Kui\"}},\"markdownRemark\":{\"id\":\"/Users/yk/Documents/blog/src/pages/object-assign/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>在 <em>immutable struct</em> 或者说 <em>functional programming</em> 的影响下, <code>Object.assign</code> 和 <a href=\\\"https://github.com/tc39/proposal-object-rest-spread\\\">Object Spread</a> 是我们离不开的操作. 不过它的功能真的是 <em>shadow copy</em> 吗? 这里我列出一个例子来记录这个问题, 以防以后碰到坑.</p>\\n<p>下面是一个对象, 包括了几种典型的属性:</p>\\n<ol>\\n<li>普通属性</li>\\n<li>get 属性</li>\\n<li>set 属性</li>\\n<li>\\n<p>Symbol</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> obj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\na<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token keyword\\\">get</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__GETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token keyword\\\">set</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span>val<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__SETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> val <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">[</span><span class=\\\"token function\\\">Symbol</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'cool'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'good'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n</li>\\n</ol>\\n<p>先提出问题, 哪种类型的属性会被成功 copy? <code>get 和 set</code> 时候会被运行呢?</p>\\n<p>首先可以确定的是, 连续两次打印 <code>obj.hh</code> 的话, 一定会得到 <code>2, 3</code>. 因为每次 <code>hh</code> 都会被运行对吧.</p>\\n<p>OK, 现在开始对它 <code>assign</code>, 有下面代码</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> shadow <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token operator\\\">...</span>obj<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>这个时候得到的值是多少呢(假设这串代码紧接上面的代码)\\n最后的结果是 <code>4, 4</code>\\n这说明什么? 说明 GET 只被运行了一次后, 就再也没有运行了.\\n那我们打印一下 shadow 的内部看看,</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>shadow<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-89bbd.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 27.54491017964072%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAl0lEQVQY052RwQqGIBCEfROz6KSUEaloUQS+/yPNzyzUocMPdRhWZvWbXVTTNME5B2MMmqYRaa3v81spgi7Ys/4LuLznXcXpYozIOWMcR4QQcByHeNQ8z1jXFbVW7PsufXrs0T/PE9u2yXv6qpSClBKWZZHa972kf11bJmQqNQwDvPfouu4zVPFTuArFCQkm1FqLtm1fQ3/LTa6jhPDc2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"06FE5C2C 8A1B 45EE B45D D3DB0774F9FA\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-1a291.png 148w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-2bc4a.png 295w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fb8a0.png 590w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-526de.png 885w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-fa2eb.png 1180w,\\n/blogs/static/06FE5C2C-8A1B-45EE-B45D-D3DB0774F9FA-b0dd709a206bcde06de0b0ffc0157ef2-89bbd.png 1336w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>注意到, 这个时候 hh 只是一个普通的属性, 而不再属于 get set. 作为对比, 我们看下 obj 会输出什么.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-ca8a9.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 26.794871794871796%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAgUlEQVQY052POw7EIAxEOQoQRRASQAgIn2Jz/1PNChco260oxrYs+3nMvPfQWuM8T+z7Tvm6LuoNWWtJSqk555yj2hiDbdvAOZ9iUkrknBFC+Mlj6T34r9gI932j946UEmKMdH0FRsDjONBaI1ApBcPxKmw6rLXi+Tzz3QEVQiwBvz0wj4W+EaSVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"336C40D7 A962 48C0 B485 B81EDD28B4EA\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-1a291.png 148w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-2bc4a.png 295w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fb8a0.png 590w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-526de.png 885w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-fa2eb.png 1180w,\\n/blogs/static/336C40D7-A962-48C0-B485-B81EDD28B4EA-73ccd330d70754382a3ed1d85ee766e1-ca8a9.png 1560w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>所以结论就是, 普通属性和 Symbol 会被 Copy. 至于 Symbol 时候还是原来那个, 自己测试一下可以发现肯定是的.</p>\\n<p>那么, 另外一个问题. 这些 GET 和 SET 是在什么情况下被执行的呢? 我们可以看到, 上面只打印出了 <strong><em>GETTER</em></strong> 而没有 <strong><em>SETTER</em></strong>, 先引用 MDN 的文档</p>\\n<blockquote>\\n<p>The Object.assign() method only copies enumerable and own properties from a source object to a target object. It uses [[Get]] on the source and [[Set]] on the target, so it will invoke getters and setters.\\n也就是说, 第二个参数的 GET 会被调用, 第一个参数的 SET 会被调用. 而因为 <code>{…obj}</code> 就相当于 <code>Object.assign({},obj)</code>, 所以只有 obj 会被调用.</p>\\n</blockquote>\\n<p>那怎么证明 SET 会被调用呢? 这个简单, 使用 <code>Object.assign(obj, obj)</code> 就行.\\n如果现在的代码是这样的</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> symbol <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Symbol</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'cool'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> obj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  a<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">get</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__GETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">set</span> <span class=\\\"token function\\\">hh</span><span class=\\\"token punctuation\\\">(</span>val<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'__SETTER__'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>a <span class=\\\"token operator\\\">+=</span> val <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">[</span>symbol<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'good'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>hh<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> aha <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">assign</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">,</span> obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nconsole<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span>Reflect<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">ownKeys</span><span class=\\\"token punctuation\\\">(</span>aha<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>会出现下面的结果.</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 538px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 115.98513011152416%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAACeUlEQVQ4y53VZ04rQRAE4D0FEphksk0y0WQcwIBAFve/TD99LTXCgocQP0aTtquranpmm62trdjb24vT09O4urqKi4uLODg4iNXV1T+15vDwMG5vbxPw7OwsQS8vL8P6nwA7nU6MRqN4fHyM19fXmE6ncX9/H9vb2/nByspKtl8Dkojd5uZmLC4uZmu32zn/DPRb0EZgt9uNXq8X6+vryazb6QZvgVCwv7+f4+Xl5VhaWvoRvClJgs7Pz1P+cDiMt7e3nPf7/WySSiYBBf8DbWog+8nJSYKMx+O4vr5OUAlUgQNzWE9PTzkH+p0VzeeJ7Erm6Ogojo+PY2dnJ4Gc+O7ubrRarbTGnu/Mi8wMIF80H2KGhVLClHwsrbMFoINUCRIjwe8ZQNl5hAm/BJAFiA1A9dgKBqwy7u7uElA8luQnoE1AVTo2MC72CwsLsba2lmPe6X03Pz+f69Y2Njayb8pYnmChkWJTEmNrpFJgjBUF9rEr3zH/AFQSfCKTFCwmk0kMBoPsXUnSjQVTpQpKevk8UzYOReDNzU1mBcB8B6RksDTXF2Pe+9Yc6w9AEm1WgTsYZUOWD63zDAiG+rm5uYzlMU+R+igbCwIxRJ+Ul5eXnD8/P2cvETZ6TCmQSJspGwsYqTuvjTrEQv/w8JAeCbbmVFVDXQKnaz4DaBNgXb1iQpbaq7qjQHA9EiXzy02psqmXu25MBXsrHZSEfP3xtSlAUjDjFanj0TgfXHKdoFN22sDrZvz42gDFTCAQwVjylWz+YVy/i/rvFNvqv7w2spefykhwvT5Y2Te2DqQehupnAAXW6yLg/f09vSNdj3EBUuHWmDtptsD4B/1ettyM7j3pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"7F67AD27 E0D9 42B7 AB4C D67D9A4C7241\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png\\\"\\n        srcset=\\\"/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-8da5a.png 148w,\\n/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-ca340.png 295w,\\n/blogs/static/7F67AD27-E0D9-42B7-AB4C-D67D9A4C7241-306e2f20608f2abb12380067efc28b5f-e4609.png 538w\\\"\\n        sizes=\\\"(max-width: 538px) 100vw, 538px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>在这里, GET 和 SET 都被调用了一次, 分别是 source 和 target 调用的. 而这个时候 a 变成 12 也不难解释.\\n因为 <code>obj.a</code> 目前是 3. 当 assign 被调用的时候, 内部会有一个 <code>obj.a = obj.a</code> 的过程.  先 GET, 就让 <code>obj.a</code> 变成了 4, 然后是 GET, 也就是 <code>obj.a += obj.a * 4</code> 就成了 12.</p>\\n<p>不过, 值得注意的是, 这里 hh 还是 GET 和 SET, 并没有被替换成普通的属性. 不知道这是不是有意为之.\\n那么如果对象中存在 get 和 set 的时候该怎么复制的呢? 如果用到 ES7 的特性的话, 会很简单</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code><span class=\\\"token keyword\\\">const</span> realShadow <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPrototypeOf</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-07a60.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 26.848249027237355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAiklEQVQY052PzQrEIAyEfRRbi4rWtv4rFHz/p5rdeCh7XHqYhEnCx4Sd5wmtNfZ9x7ZtsNbCOQel1Jwfx/F4Eu1pRp32Ukpwzh+xdV2RUoL3HrVWXNeFnMv0v4f/ilEh4H3fKKUghABjzCvYBFLs3vuEttZAid/CnoSUbIyBGOP33QwhBJZleQX8AGNYj6u+BZNSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"1A25BA7A 053A 42D7 91AB 2184F28CFAA5\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fb8a0.png\\\"\\n        srcset=\\\"/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-1a291.png 148w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-2bc4a.png 295w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fb8a0.png 590w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-526de.png 885w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-fa2eb.png 1180w,\\n/blogs/static/1A25BA7A-053A-42D7-91AB-2184F28CFAA5-af279db6c89a2d5d7aa85a971678507a-07a60.png 1542w\\\"\\n        sizes=\\\"(max-width: 590px) 100vw, 590px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>这里 a 的值还是 3, 说明这个 get 根本没有被执行, 完成没有副作用. 这才是真正的浅拷贝嘛!</p>\\n<p>OK, 那么这里可以得出一个结论: 对于普通的纯对象, 比如 redux 里保存的那些, 使用 <code>assign</code> 没有任何问题. 但如果是自己定义的复杂对象, 带了很多 get 的话, 最好的方式还是采用下面这种最安全的方式吧.</p>\\n<p>值得一提的是, 这也是 MDN 推荐的方式:</p>\\n<blockquote>\\n<p>Whereas the Object.assign() method will only copy enumerable and own properties from a source object to a target object, you are able to use this method and Object.create() for a shallow copy between two unknown objects</p>\\n</blockquote>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code>Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span>\\n  Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getPrototypeOf</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getOwnPropertyDescriptors</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\",\"frontmatter\":{\"title\":\"Object.assign 的一些问题\",\"date\":\"2018/01/31\"}}},\"pathContext\":{\"slug\":\"/object-assign/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/object-assign.json\n// module id = 492\n// module chunks = 150799105546278"],"sourceRoot":""}